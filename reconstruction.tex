\section{Type Reconstruction}\label{sec:reconstruction}
In this section we proposed a constraint-based type reconstruction
procedure for the extended type system, which is similiar to the one
in Kobayashi et al.~\cite{DBLP:journals/lmcs/KobayashiSW06}.  This
procedure can generate constraints for a given program to be definite
and well-typed by constructing a derivation tree based on the rules in
Figure~\ref{fig:TypingRules}. According to this procedure, the
generated constraint is either a subtyping constraint \(P \le \alpha
\) or \(\OK_\nu(\alpha, F)\) in which \(\nu\) represents an unknown
number of available memory cells. The predication \(OK_n(P, F)\) only
appears in the rule \(\rn{T-Program}\), therefore only one constraint of
\(OK_\nu(\alpha, F)\) is included in the constraints set.

By using the result obtained by Kobayashi et al.~\cite[Lemma
  3.8]{DBLP:journals/lmcs/KobayashiSW06}, a subtyping constraint
\(\alpha \ge P\) can be resolved by setting \(\alpha = \mu
\alpha. P\), which is the least solution of the constraint.  Hence,
the generated constraint set is reduced to a single constraint
\(\OK_{\nu}(P', F)\) for some behavioral type \(P'\).

By definition, \(\OK_{\nu}(P, F)\) holds if there is a natural number
\(n\) such that, for all \(\sigma\) and \(P'\), \(P
\xlongrightarrow{\sigma} P'\) implies \(\sharp_{\Malloc}(\sigma) -
\sharp_{\Free}(\sigma) \le n\).  In order to check this condition
soundly, we fix the upper bound of \(\nu\) to be checked.  Then,
\(\OK_{\nu}(P, F)\) can be checked by model-checking a system with
finitely many states; hence, model checkers like
CPAChecker~\cite{beyer2011cpachecker} can be applicable.
