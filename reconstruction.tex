\section{Type Reconstruction}\label{sec:reconstruction}

%% This section describes a type reconstruction procedure for the type
%% system in Section~\ref{sec:typesystem}.  Since the procedure is
%% essentially the same as one in Kobayashi et
%% al.~\cite{DBLP:journals/lmcs/KobayashiSW06}, we do not give a concrete
%% definition here.

%% %% \footnote{The procedure
%% %%   described here is not complete; see Section~\ref{sec:conclusion}.

%% The reconstruction procedure is a constraint-based one.  It generates,
%% given a program, constraints for the program to be well-typed by
%% constructing a derivation tree based on the rules in
%% Figure~\ref{fig:TypingRules}.  A constraint is either a subtyping
%% constraint \(\alpha \ge P\), or \(\OK_\nu(\alpha)\), where \(\nu\) is
%% a symbol for an unknown natural number.  Since \rn{T-Prog} is the only
%% place where the condition \(\OK_n(P)\) is involved, the constraint set
%% includes exactly one constraint of the form \(\OK_\nu(\alpha)\).  The
%% concrete definition of the constraint generation is in the full
%% version~\cite{fullversion}.

%% By using the result obtained by Kobayashi et al.~\cite[Lemma
%%   3.8]{DBLP:journals/lmcs/KobayashiSW06}, a subtyping constraint
%% \(\alpha \ge P\) can be resolved by setting \(\alpha = \mu
%% \alpha. P\), which is the least solution of the constraint.  Hence,
%% the generated constraint set is reduced to a single constraint
%% \(\OK_{\nu}(P')\) for some behavioral type \(P'\).

%% By definition, \(\OK_{\nu}(P)\) holds if there is a natural number
%% \(n\) such that, for all \(\sigma\) and \(P'\), \(P
%% \xlongrightarrow{\sigma} P'\) implies \(\sharp_{\Malloc}(\sigma) -
%% \sharp_{\Free}(\sigma) \le n\).  In order to check this condition
%% soundly, we fix the upper bound of \(\nu\) to be checked.  Then,
%% \(\OK_{\nu}(P)\) can be checked by model-checking a system with
%% finitely many states; hence, model checkers like
%% CPAChecker~\cite{beyer2011cpachecker} and
%% SPIN~\cite{holzmann2004spin,ben2008principles} are
%% applicable.  More detailed description on how we apply a
%% model-checking algorithm to check \(\OK_\nu(P)\) is in the forthcoming
%% version.
